<h2>Monthly Cashflow Summary</h2>
<div class="table-responsive text-truncate small">
<% if @current_user %>
  <form action="/" method="get">
    <label>Select years</label>
    <div>
      <% @available_years.each do |year| %>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" name="years[]" id="year_<%= year %>" value="<%= year %>"<%= 'checked' if @selected_years.include?(year) %>>
          <label class="form-check-label" for="year_<%= year %>">
            <%= year %>
          </label>
        </div>
      <% end %>
    </div>
    <button type="submit" class="btn btn-outline-secondary btn-sm me-2">Filter</button>
  </form>



  <table class="table">
    <thead>
    <tr>
      <th>Type</th>
      <% @monthly_data.keys.each do |month| %>
        <th><%= month %></th>
      <% end %>
    </tr>
    </thead>
    <tbody>
    <% @row_labels.each do |label| %>
      <% # Skip labels where all monthly values are zero or nil %>
      <% next if @monthly_data.all? { |_, types| (types[label] || 0).zero? } %>
      <tr>
        <td><%= label.presence || "Unspecified" %></td>
        <% @monthly_data.each do |_, types| %>
          <td>
            <%= Money.new((types[label] || 0) * 100, "EUR").format %>
          </td>
        <% end %>
      </tr>
    <% end %>
    </tbody>
  </table>

  <%= line_chart @cashflows.group(:type_name).group_by_month(:date).sum(:amount) %>





<% else %>
<p>You need to <%= link_to 'sign in', new_user_session_path %> or <%= link_to 'sign up', new_user_registration_path %> before continuing.</p>
<% end %>
</div>