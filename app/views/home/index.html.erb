<h2>Monthly Cashflow Summary</h2>

<%= form_with url: root_path, method: :get, local: true do |form| %>
  <%= form.label :years, "Select years" %>
  <%= form.select :years, options_for_select(@available_years.map { |year| [year, year] }, selected: @selected_years), prompt: 'Select years', multiple: true, class: 'form-select' %>
  <%= form.submit 'Filter', class: 'btn btn-primary' %>
<% end %>

<script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function() {
        // Check if jQuery is loaded
        if (typeof jQuery !== 'undefined') {
            console.log("jQuery is loaded!");
            $('select[multiple]').select2({
                placeholder: 'Select years',
                allowClear: true
            });
        } else {
            console.log("jQuery is not loaded");
        }
    });
</script>

<table border="1" class="table">
  <thead>
  <tr>
    <th>Type</th>
    <% @monthly_data.keys.each do |month| %>
      <th><%= month %></th>
    <% end %>
  </tr>
  </thead>
  <tbody>
  <% @row_labels.each do |label| %>
    <% # Skip labels where all monthly values are zero or nil %>
    <% next if @monthly_data.all? { |_, types| (types[label] || 0).zero? } %>
    <tr>
      <td><%= label.presence || "Unspecified" %></td>
      <% @monthly_data.each do |_, types| %>
        <td>
          <%= Money.new((types[label] || 0) * 100, "EUR").format %>
        </td>
      <% end %>
    </tr>
  <% end %>
  </tbody>
</table>



